<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>编号</th>
      <th>用户</th>
      <th>模板</th>
      <th>标题</th>
      <th>创建时间</th>
      <th>支付状态</th>
      <th colspan="4">操作</th>
    </tr>
  </thead>

  <tbody>
    <% sites.each do |site| %>
      <tr>
        <td><%= site.id %></td>
        <td>
          <% if site.user_id.present? %>
            <%= link_to site.user.email, user_path(site.user_id) %>
          <% else %>
            <%= link_to site.member.auth_id, member_path(site.member_id) %>
          <% end %>
        </td>
        <td><%= site.template.title %></td>
        <td><%= site.title %></td>
        <td><%= get_time site.created_at %></td>
        <td><span class="<%= site.site_payment.state == 'completed' ? 'blue' : (site.site_payment.state == 'opening' ? '' : 'orange') %>"><%= payment_state(site) %></span></td>
        
        <td><%= link_to '预览', get_site_url(site), target: '_blank' %></td>
        <td><%= link_to '详细', site_path(site), target: '_blank' %></td>
        <td><%= link_to '修改', edit_site_path(site) %></td>
        <td><%= link_to '删除', site, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= will_paginate sites %>